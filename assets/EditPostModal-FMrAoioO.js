import{c as Le,r as n,m as N,j as e,L,n as y,B as d,M as Ze,X as De,D as $e,q as ze,s as Fe,t as Te,v as Pe}from"./index-DLqimMV8.js";import{C as Ue,a as es}from"./card-CY9-ve7w.js";import{A as V,a as X,b as Q}from"./index-EfjSmcDM.js";import{B as se}from"./badge-CME7s750.js";import{T as ae}from"./textarea-Dc95vB93.js";import{D as ss,b as as,c as rs,d as me}from"./dropdown-menu-7k7ytBg1.js";import{E as ts,S as is}from"./send-COm1LQ5b.js";import{S as xe}from"./square-pen-CjVE55qt.js";import{T as he}from"./trash-2-CP23ljvT.js";import{M as ls}from"./site-header-CKtPnSCF.js";import{H as ns}from"./heart-D1UYKJAB.js";import{b as os}from"./bookmark-B2_N_nt6.js";import{L as ue}from"./label-DBxNtR5w.js";import{S as cs,a as ds,b as ms,c as xs,d as hs}from"./select-d49l-vTK.js";import{u as us}from"./toast-7vBxPuBc.js";/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],ps=Le("reply",gs);/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],vs=Le("share-2",fs),js={alcance:"Alcance",cliques:"Cliques",conversao:"Conversões",engajamento:"Engajamento"},Ts=({post:a,currentUser:o,onLike:u,onComment:Y,onShare:f,onDelete:D,onUpdate:B,onSave:$,onFollow:g,showSaveButton:z=!0,isSaved:v=!1,showGroupBadge:O=!1,groupName:F=null})=>{const[b,T]=n.useState(!1),[j,m]=n.useState([]),[k,Z]=n.useState(""),[x,c]=n.useState(null),[w,ge]=n.useState(!1),[pe,Me]=n.useState([]),[U,I]=n.useState(a.user_liked||a.isLiked||!1),[q,P]=n.useState(a.likes||0),[Re,S]=n.useState(a.comentarios||0),[M,fe]=n.useState(!1),[re,ve]=n.useState(!1),[J,W]=n.useState(v||a.user_saved||a.isSaved||!1),[te,je]=n.useState(a.isFollowed||!1),[C,ie]=n.useState(null),[_,G]=n.useState(""),[E,we]=n.useState(!1),[Be,Oe]=n.useState({}),H=n.useRef(!1),A=n.useRef(null),Ne=!!(a?.sponsored||a?.is_promovido||a?.isPromovido||a?.ad_campaign_id),K=a?.sponsored_campaign,Ie=a?.sponsored_badge||"Patrocinado",ye=K?.objetivo?js[K.objetivo]||K.objetivo:null;n.useEffect(()=>{I(a.user_liked||a.isLiked||!1),P(a.likes||0),W(v||a.user_saved||a.isSaved||!1),je(a.isFollowed||!1)},[a.user_liked,a.isLiked,a.likes,v,a.user_saved,a.isSaved,a.isFollowed]);const le=n.useCallback(async()=>{if(!(M||H.current)){H.current=!0,fe(!0);try{const s=await N.getComments(a.id,{limit:10});s.success&&(m(s.comments||[]),S(s.total||s.comments?.length||0))}catch(s){console.error("Erro ao carregar comentários:",s),H.current=!1}fe(!1)}},[a.id,M]),be=n.useCallback(async()=>{ve(!0);try{const s=await N.getLikes(a.id);s.success&&(Me(s.likes||[]),P(s.total||0))}catch(s){console.error("Erro ao carregar likes:",s)}ve(!1)},[a.id]),ne=n.useCallback((s,l)=>{m(t=>t.map(r=>{if(r.id===s){const i=l(r);return Array.isArray(r.replies)&&!Array.isArray(i.replies)&&(i.replies=r.replies),i}if(Array.isArray(r.replies)&&r.replies.length>0){let i=!1;const h=r.replies.map(p=>p.id===s?(i=!0,l(p)):p);if(i)return{...r,replies:h}}return r}))},[]),Ce=n.useCallback((s,l=null)=>{ie({id:s.id,parentId:l}),G(s.conteudo||""),c(null)},[]),oe=n.useCallback(()=>{ie(null),G("")},[]),ke=n.useCallback(async()=>{if(!C||!_.trim())return;const s=C.id,l=_.trim(),t=!!C.parentId;try{A.current=JSON.parse(JSON.stringify(j))}catch{A.current=j}ne(s,r=>({...r,conteudo:l,updated_at:new Date().toISOString()})),we(!0);try{const r=await N.updateComment(s,{conteudo:l});if(r.success&&r.comment){const i=r.comment;ne(s,h=>{const p={...h,...i};return t||(p.replies=h.replies??(Array.isArray(i.replies)?i.replies:[])),p})}else A.current&&m(A.current)}catch(r){console.error("Erro ao atualizar comentário:",r),A.current&&m(A.current)}finally{we(!1),ie(null),G(""),A.current=null}},[j,C,_,ne]),qe=n.useCallback(s=>{m(l=>l.map(t=>{if(t.id===s)return null;if(Array.isArray(t.replies)&&t.replies.length>0){const r=t.replies.filter(i=>i.id!==s);if(r.length!==t.replies.length)return{...t,replies:r}}return t}).filter(Boolean))},[]);n.useEffect(()=>{b&&!H.current&&!M&&le()},[b,le,M]),n.useEffect(()=>{w&&!re&&be()},[w,a.id,be,re]);const Je=async()=>{if(!o)return;const s=U,l=q,t=!U,r=t?q+1:q-1;I(t),P(r);try{const i=await N.toggleLike(a.id);i.success?(I(i.liked),P(i.likesCount||i.likes_count||r),u&&u(a.id,i.liked,i.likesCount||i.likes_count||r)):(I(s),P(l))}catch(i){console.error("Erro ao curtir post:",i),I(s),P(l)}},Se=async()=>{if(!o||!k.trim())return;const s={id:`temp-${Date.now()}`,conteudo:k.trim(),autor:o.nome,nome:o.nome,username:o.username,avatar_url:o.avatar_url,avatar:o.avatar_url,foto_perfil:o.foto_perfil,created_at:new Date().toISOString(),parent_id:x?.id||null,replies:[],user_id:Number(o.id)};m(x?t=>t.map(r=>r.id===x.id?{...r,replies:[...r.replies||[],s]}:r):t=>[...t,s]),S(t=>t+1);const l=k;Z(""),c(null);try{const t=await N.createComment(a.id,{conteudo:l.trim(),parent_id:x?.id||null});t.success?(m(x?r=>r.map(i=>i.id===x.id?{...i,replies:(i.replies||[]).map(h=>h.id===s.id?t.comment:h)}:i):r=>r.map(i=>i.id===s.id?t.comment:i)),Y&&Y(a.id,t.comment,x?.id)):(m(x?r=>r.map(i=>i.id===x.id?{...i,replies:(i.replies||[]).filter(h=>h.id!==s.id)}:i):r=>r.filter(i=>i.id!==s.id)),S(r=>r-1))}catch(t){console.error("Erro ao comentar:",t),m(x?r=>r.map(i=>i.id===x.id?{...i,replies:(i.replies||[]).filter(h=>h.id!==s.id)}:i):r=>r.filter(i=>i.id!==s.id)),S(r=>r-1)}},_e=async s=>{if(!o)return;C?.id===s&&oe();let l=null;try{l=JSON.parse(JSON.stringify(j))}catch{l=j}qe(s),S(t=>Math.max(t-1,0));try{!(await N.deleteComment(s)).success&&l&&(m(l),S(r=>r+1))}catch(t){console.error("Erro ao deletar comentário:",t),l&&(m(l),S(r=>r+1))}},We=async()=>{if(!o)return;const s=J;W(!J);try{const t=await N.toggleSavePost(a.id);t.success?(W(t.saved),$&&$(a.id,t.saved)):W(s)}catch(t){console.error("Erro ao salvar post:",t),W(s)}},Ge=async()=>{if(o&&a.user_id!==o.id)try{const s=await N.toggleFollow(a.user_id);if(s.success){const l=s.following,t=s.followers_count||s.followersCount||0;je(l),g&&g(a.user_id,l,t)}}catch(s){console.error("Erro ao seguir usuário:",s)}},ce=s=>{const l=new Date,t=new Date(s),r=Math.floor((l-t)/1e3);return r<60?"agora":r<3600?`${Math.floor(r/60)}min`:r<86400?`${Math.floor(r/3600)}h`:r<2592e3?`${Math.floor(r/86400)}d`:t.toLocaleDateString("pt-BR")},He=()=>{if(a.tipo_midia==="imagem"&&a.imagem_url)return e.jsx("div",{className:"rounded-xl overflow-hidden mt-3",children:e.jsx("img",{src:y.getPublicUrl(a.imagem_url),alt:"Imagem do post",className:"w-full max-h-96 object-cover cursor-pointer hover:opacity-95 transition-opacity",onClick:()=>window.open(y.getPublicUrl(a.imagem_url),"_blank")})});if(a.tipo_midia==="video"&&a.video_url)return e.jsx("div",{className:"rounded-xl overflow-hidden mt-3",children:e.jsx("video",{src:y.getPublicUrl(a.video_url),controls:!0,className:"w-full max-h-96 object-cover",poster:"/placeholder.svg?height=300&width=500"})});if(a.media_files&&a.media_files.length>0){const s=a.media_files;if(s.length===1){const l=s[0],t=y.getApiUrl(`posts/media.php?id=${l.id}`);if(l.media_type.startsWith("image/"))return e.jsx("div",{className:"rounded-xl overflow-hidden mt-3",children:e.jsx("img",{src:t,alt:l.media_filename,className:"w-full max-h-96 object-cover cursor-pointer hover:opacity-95 transition-opacity",onClick:()=>window.open(t,"_blank")})});if(l.media_type.startsWith("video/"))return e.jsx("div",{className:"rounded-xl overflow-hidden mt-3",children:e.jsx("video",{src:t,controls:!0,className:"w-full max-h-96 object-cover",poster:"/placeholder.svg?height=300&width=500"})})}else return e.jsx("div",{className:`grid gap-2 rounded-xl overflow-hidden mt-3 ${s.length===2||s.length===3,"grid-cols-2"}`,children:s.map((l,t)=>{const r=y.getApiUrl(`posts/media.php?id=${l.id}`);return e.jsx("div",{className:`relative ${s.length===3&&t===0?"row-span-2":""}`,children:l.media_type.startsWith("image/")?e.jsx("img",{src:r,alt:l.media_filename,className:"w-full h-full object-cover min-h-[150px] max-h-[300px] cursor-pointer hover:opacity-95 transition-opacity",onClick:()=>window.open(r,"_blank")}):e.jsx("video",{src:r,controls:!0,className:"w-full h-full object-cover min-h-[150px] max-h-[300px]"})},l.id)})})}return null},Ke=s=>s?typeof s=="string"&&s.startsWith("http")?s:y.getPublicUrl(s):"",Ee=s=>s?Ke(s.avatar||s.avatar_url||s.foto_perfil||s.user?.avatar_url||s.user?.foto_perfil):"",Ve=(s,l)=>{const t=s.autor||s.author||s.nome||"Usuário",r=s.username||s.user?.username||"unknown",i=Ee(s),h=!!o&&(Number(o.id)===Number(s.user_id)||s.isOwner),p=C?.id===s.id;return e.jsxs("div",{className:"flex space-x-2 sm:space-x-3",children:[e.jsx(L,{to:`/perfil/${r}`,className:"flex-shrink-0",children:e.jsxs(V,{className:"w-5 h-5 sm:w-6 sm:h-6 hover:opacity-80 transition-opacity",children:[e.jsx(X,{src:i}),e.jsx(Q,{className:"text-xs bg-sage text-white",children:t.charAt(0).toUpperCase()})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-gray-100 rounded-lg p-1.5 sm:p-2",children:[e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 mb-1",children:[e.jsx(L,{to:`/perfil/${r}`,className:"font-medium text-xs hover:underline",children:t}),e.jsxs(L,{to:`/perfil/${r}`,className:"text-coral text-xs hover:underline",children:["@",r]}),e.jsx("span",{className:"text-gray-500 text-xs",children:ce(s.created_at)})]}),p?e.jsxs(e.Fragment,{children:[e.jsx(ae,{value:_,onChange:de=>G(de.target.value),className:"text-xs",rows:3}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(d,{size:"sm",className:"bg-coral hover:bg-coral/90 text-white h-8",onClick:ke,disabled:E||!_.trim(),children:E?"Salvando...":"Salvar"}),e.jsx(d,{variant:"outline",size:"sm",className:"h-8",onClick:oe,disabled:E,children:"Cancelar"})]})]}):e.jsx("p",{className:"text-xs text-gray-800 break-words whitespace-pre-wrap overflow-wrap-anywhere",children:s.conteudo})]}),h&&!p&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(d,{variant:"ghost",size:"sm",className:"text-xs text-gray-500 hover:text-coral px-1 py-0.5 h-auto",onClick:()=>Ce(s,l),children:[e.jsx(xe,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(d,{variant:"ghost",size:"sm",className:"text-xs text-gray-500 hover:text-red-500 px-1 py-0.5 h-auto",onClick:()=>_e(s.id),children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),"Deletar"]})]})]})]},s.id)},Xe=s=>{const l=s.autor||s.author||s.nome||"Usuário",t=s.username||s.user?.username||"unknown",r=Ee(s),i=!!o&&(Number(o.id)===Number(s.user_id)||s.isOwner),h=C?.id===s.id,p=Array.isArray(s.replies)?s.replies:[],de=o&&Number(o.id)===Number(s.user_id),Ae=Be[s.user_id]??s.isFollowing??!1,Qe=async R=>{R.preventDefault(),R.stopPropagation();try{const ee=await N.toggleFollow(s.user_id);ee.success&&Oe(Ye=>({...Ye,[s.user_id]:ee.following}))}catch(ee){console.error("Erro ao seguir usuário:",ee)}};return e.jsxs("div",{className:"flex space-x-2 sm:space-x-3 py-2 sm:py-3",children:[e.jsx(L,{to:`/perfil/${t}`,className:"flex-shrink-0",children:e.jsxs(V,{className:"w-7 h-7 sm:w-8 sm:h-8 hover:opacity-80 transition-opacity",children:[e.jsx(X,{src:r}),e.jsx(Q,{className:"text-xs bg-coral text-white",children:l.charAt(0).toUpperCase()})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 sm:p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[e.jsx(L,{to:`/perfil/${t}`,className:"font-medium text-xs sm:text-sm hover:underline",children:l}),e.jsxs(L,{to:`/perfil/${t}`,className:"text-coral text-xs sm:text-sm hover:underline",children:["@",t]}),e.jsx("span",{className:"text-gray-500 text-xs",children:ce(s.created_at)})]}),o&&!de&&e.jsx(d,{variant:"ghost",size:"sm",className:`text-xs h-6 px-2 ${Ae?"text-gray-600":"text-coral hover:text-coral/90"}`,onClick:Qe,children:Ae?"Seguindo":"Seguir"})]}),h?e.jsxs(e.Fragment,{children:[e.jsx(ae,{value:_,onChange:R=>G(R.target.value),rows:3,className:"text-sm"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(d,{size:"sm",className:"bg-coral hover:bg-coral/90 text-white h-8",onClick:ke,disabled:E||!_.trim(),children:E?"Salvando...":"Salvar"}),e.jsx(d,{variant:"outline",size:"sm",className:"h-8",onClick:oe,disabled:E,children:"Cancelar"})]})]}):e.jsx("p",{className:"text-xs sm:text-sm text-gray-800 break-words whitespace-pre-wrap overflow-wrap-anywhere",children:s.conteudo})]}),e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4 mt-2",children:[e.jsxs(d,{variant:"ghost",size:"sm",className:"text-xs text-gray-500 hover:text-coral px-1 py-0.5 h-auto",onClick:()=>c(s),disabled:h,children:[e.jsx(ps,{className:"w-3 h-3 mr-1"}),"Responder"]}),i&&!h&&e.jsxs(d,{variant:"ghost",size:"sm",className:"text-xs text-gray-500 hover:text-coral px-1 py-0.5 h-auto",onClick:()=>Ce(s),children:[e.jsx(xe,{className:"w-3 h-3 mr-1"}),"Editar"]}),i&&e.jsxs(d,{variant:"ghost",size:"sm",className:"text-xs text-gray-500 hover:text-red-500 px-1 py-0.5 h-auto",onClick:()=>_e(s.id),disabled:E&&C?.id===s.id,children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),"Deletar"]})]}),p.length>0&&e.jsx("div",{className:"ml-2 sm:ml-4 mt-2 sm:mt-3 space-y-2 sm:space-y-3",children:p.map(R=>Ve(R,s.id))})]})]},s.id)};return e.jsx(Ue,{className:"shadow-sm hover:shadow-md transition-shadow overflow-hidden",children:e.jsxs(es,{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[e.jsxs(L,{to:`/perfil/${a.username}`,className:"flex items-start space-x-2 sm:space-x-3 hover:underline min-w-0 flex-1",children:[e.jsxs(V,{className:"w-10 h-10 sm:w-12 sm:h-12 flex-shrink-0",children:[e.jsx(X,{src:a.avatar?y.getPublicUrl(a.avatar):""}),e.jsx(Q,{className:"bg-coral text-white text-sm",children:a.autor.charAt(0)})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm sm:text-base truncate",children:a.autor}),O&&F&&e.jsx(se,{variant:"outline",className:"bg-olive/10 text-olive border-olive/20 text-xs",children:F}),Ne&&e.jsx(se,{variant:"outline",className:"bg-amber-100 text-amber-700 border-amber-200 uppercase tracking-wide text-[10px] sm:text-xs",children:Ie})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 text-xs sm:text-sm text-gray-500",children:[e.jsxs("span",{className:"text-coral font-medium break-all",children:["@",a.username]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"whitespace-nowrap",children:a.tempo||ce(a.created_at)})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 flex-shrink-0",children:[o&&a.user_id!==o.id&&e.jsx(d,{variant:te?"outline":"default",size:"sm",onClick:Ge,className:`text-xs px-2 py-1 h-auto ${te?"border-coral text-coral hover:bg-coral hover:text-white":"bg-coral hover:bg-coral/90 text-white"}`,children:te?"Seguindo":"Seguir"}),e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"sm",className:"rounded-full h-8 w-8 p-0",children:e.jsx(ts,{className:"h-4 w-4"})})}),e.jsx(rs,{align:"end",className:"w-40",children:o&&o.id===a.user_id?e.jsxs(e.Fragment,{children:[e.jsxs(me,{onClick:()=>B&&B(a),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Editar"]}),e.jsxs(me,{className:"text-red-600",onClick:()=>D&&D(a.id),children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Deletar"]})]}):e.jsx(me,{className:"text-yellow-600",children:"Reportar"})})]})]})]}),Ne&&e.jsxs("div",{className:"mb-3 sm:mb-4 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-xs sm:text-sm text-amber-700 flex items-start gap-2",children:[e.jsx(ls,{className:"h-4 w-4 flex-shrink-0 text-amber-500 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-semibold text-amber-800 leading-snug",children:[K?.titulo?`Campanha “${K.titulo}”`:"Conteúdo patrocinado",ye?` • ${ye}`:""]}),e.jsx("p",{className:"leading-snug",children:"Este post foi impulsionado para alcançar mais empreendedoras na comunidade EmpowerUp."})]})]}),a.categoria&&e.jsx(se,{className:"mb-3 bg-coral/10 text-coral hover:bg-coral/20 text-xs",children:a.categoria}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx("p",{className:"text-gray-800 leading-relaxed text-sm sm:text-base break-words whitespace-pre-wrap overflow-wrap-anywhere",children:a.conteudo}),(()=>{let s=[];try{typeof a.tags=="string"?s=JSON.parse(a.tags):Array.isArray(a.tags)&&(s=a.tags)}catch{typeof a.tags=="string"&&(s=a.tags.split(",").map(t=>t.trim()).filter(t=>t.length>0))}return s&&s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 sm:gap-2 mt-3",children:s.map((l,t)=>e.jsx("span",{className:"text-coral hover:text-coral/80 cursor-pointer text-xs sm:text-sm font-medium break-words",children:l.startsWith("#")?l:`#${l}`},t))})})(),He()]}),e.jsx("div",{className:"flex items-center justify-between pt-3 sm:pt-4 border-t",children:e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-6",children:[e.jsxs(d,{variant:"ghost",size:"sm",onClick:Je,className:`transition-all duration-200 px-2 py-1 h-auto text-xs sm:text-sm ${U?"text-red-500 hover:text-red-600 bg-red-50 hover:bg-red-100":"text-coral hover:text-coral/80 hover:bg-coral/10"}`,children:[e.jsx(ns,{className:`mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4 transition-all duration-200 ${U?"fill-current scale-110":""}`}),e.jsx("span",{className:"cursor-pointer hover:underline",onClick:s=>{s.stopPropagation(),ge(!0)},children:q})]}),e.jsxs(d,{variant:"ghost",size:"sm",className:"text-olive hover:text-olive/80 px-2 py-1 h-auto text-xs sm:text-sm",onClick:()=>T(!b),onMouseEnter:()=>{!H.current&&!M&&le()},children:[e.jsx(Ze,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),Re]}),e.jsxs(d,{variant:"ghost",size:"sm",className:"text-sage hover:text-sage/80 px-2 py-1 h-auto text-xs sm:text-sm",onClick:()=>f&&f(a),children:[e.jsx(vs,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),a.compartilhamentos||0]}),z&&e.jsx(d,{variant:"ghost",size:"sm",className:`transition-all duration-200 p-1 sm:p-2 h-auto ${J?"text-blue-500 hover:text-blue-600 bg-blue-50 hover:bg-blue-100":"text-gray-500 hover:text-gray-600 hover:bg-gray-100"}`,onClick:We,title:J?"Remover dos salvos":"Salvar post",children:e.jsx(os,{className:`h-3 w-3 sm:h-4 sm:w-4 transition-all duration-200 ${J?"fill-current scale-110":""}`})})]})}),b&&e.jsxs("div",{className:"mt-4 sm:mt-6 pt-3 sm:pt-4 border-t",children:[o&&e.jsxs("div",{className:"mb-3 sm:mb-4",children:[x&&e.jsxs("div",{className:"mb-2 p-2 bg-gray-100 rounded flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600",children:["Respondendo a ",e.jsxs("strong",{children:["@",x.username]})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>c(null),className:"h-6 w-6 p-0",children:e.jsx(De,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex space-x-2 sm:space-x-3",children:[e.jsxs(V,{className:"w-7 h-7 sm:w-8 sm:h-8 flex-shrink-0",children:[e.jsx(X,{src:o.avatar_url?y.getPublicUrl(o.avatar_url):""}),e.jsx(Q,{className:"bg-coral text-white text-xs",children:o.nome.charAt(0)})]}),e.jsxs("div",{className:"flex-1 flex items-end space-x-2",children:[e.jsx(ae,{placeholder:x?`Responder para @${x.username}...`:"Escreva um comentário...",value:k,onChange:s=>Z(s.target.value),className:"flex-1 min-h-[40px] resize-none text-sm",rows:1,onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),Se())}}),e.jsx(d,{onClick:Se,disabled:!k.trim(),className:"bg-coral hover:bg-coral/90 px-3 py-2 h-auto",size:"sm",children:e.jsx(is,{className:"h-3 w-3"})})]})]})]}),e.jsx("div",{className:"space-y-4",children:M?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex space-x-3 animate-pulse",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]},s))}):j.length>0?j.map(Xe):e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Nenhum comentário ainda. Seja a primeira a comentar!"})})]}),e.jsx($e,{open:w,onOpenChange:ge,children:e.jsxs(ze,{className:"sm:max-w-md",children:[e.jsxs(Fe,{children:[e.jsxs(Te,{children:["Curtidas (",q,")"]}),e.jsx(Pe,{children:"Pessoas que curtiram este post"})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:re?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-coral mx-auto"})}):pe.length>0?pe.map(s=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(V,{className:"w-10 h-10",children:[e.jsx(X,{src:s.avatar_url||s.user?.avatar_url?y.getPublicUrl(s.avatar_url||s.user?.avatar_url):""}),e.jsx(Q,{className:"bg-coral text-white",children:s.nome||s.user?.nome?(s.nome||s.user?.nome).charAt(0):"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.nome||s.user?.nome||"Usuário"}),e.jsxs("p",{className:"text-sm text-coral",children:["@",s.username||s.user?.username||"unknown"]})]})]},s.id||s.user?.id)):e.jsx("p",{className:"text-center text-gray-500",children:"Nenhuma curtida ainda."})})]})})]})})},Ps=({isOpen:a,onClose:o,post:u,onSave:Y})=>{const[f,D]=n.useState(""),[B,$]=n.useState(""),[g,z]=n.useState([]),[v,O]=n.useState(""),[F,b]=n.useState(!1),{addToast:T}=us(),j=["Geral","Artesanato","Culinária","Moda","Beleza","Tecnologia","Negócios","Saúde","Educação"];n.useEffect(()=>{if(a&&u){D(u.conteudo||""),$(u.categoria||"Geral");let c=[];if(u.tags)try{typeof u.tags=="string"?c=JSON.parse(u.tags):Array.isArray(u.tags)&&(c=u.tags)}catch(w){console.warn("Erro ao parsear tags:",w),c=[]}z(c)}},[a,u]),n.useEffect(()=>{a||(D(""),$("Geral"),z([]),O(""),b(!1))},[a]);const m=()=>{v.trim()&&!g.includes(v.trim())&&g.length<5&&(z([...g,v.trim()]),O(""))},k=c=>{z(g.filter(w=>w!==c))},Z=c=>{c.key==="Enter"&&(c.preventDefault(),m())},x=async()=>{if(!f.trim()){T("O conteúdo do post é obrigatório","error");return}if(f.length>2e3){T("O conteúdo deve ter no máximo 2000 caracteres","error");return}b(!0);try{const c={conteudo:f.trim(),categoria:B,tags:g};await Y(u.id,c),T("Post atualizado com sucesso!","success"),o()}catch(c){console.error("Erro ao atualizar post:",c),T("Erro ao atualizar post. Tente novamente.","error")}finally{b(!1)}};return u?e.jsx($e,{open:a,onOpenChange:o,children:e.jsxs(ze,{className:"max-w-md mx-auto",children:[e.jsxs(Fe,{children:[e.jsx(Te,{children:"Editar Post"}),e.jsx(Pe,{children:"Faça alterações no seu post e salve as modificações."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ue,{htmlFor:"conteudo",children:"Conteúdo"}),e.jsx(ae,{id:"conteudo",value:f,onChange:c=>D(c.target.value),placeholder:"O que você gostaria de compartilhar?",className:"min-h-[120px]",maxLength:2e3}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[f.length,"/2000 caracteres"]})]}),e.jsxs("div",{children:[e.jsx(ue,{htmlFor:"categoria",children:"Categoria"}),e.jsxs(cs,{value:B,onValueChange:$,children:[e.jsx(ds,{children:e.jsx(ms,{placeholder:"Selecione uma categoria"})}),e.jsx(xs,{children:j.map(c=>e.jsx(hs,{value:c,children:c},c))})]})]}),e.jsxs("div",{children:[e.jsx(ue,{htmlFor:"tags",children:"Tags (opcional)"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:v,onChange:c=>O(c.target.value),onKeyPress:Z,placeholder:"Digite uma tag e pressione Enter",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-coral",maxLength:20}),e.jsx(d,{type:"button",onClick:m,disabled:!v.trim()||g.length>=5,size:"sm",children:"Adicionar"})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map((c,w)=>e.jsxs(se,{variant:"secondary",className:"flex items-center gap-1",children:["#",c,e.jsx("button",{type:"button",onClick:()=>k(c),className:"ml-1 hover:text-red-500",children:e.jsx(De,{className:"h-3 w-3"})})]},w))}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[g.length,"/5 tags"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:o,disabled:F,className:"flex-1",children:"Cancelar"}),e.jsx(d,{type:"button",onClick:x,disabled:F||!f.trim(),className:"flex-1",children:F?"Salvando...":"Salvar"})]})]})]})}):null};export{Ps as E,Ts as S};
//# sourceMappingURL=EditPostModal-FMrAoioO.js.map
