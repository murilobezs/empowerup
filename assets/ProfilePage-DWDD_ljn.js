import{w as ke,a as Le,u as Ae,r as l,n as u,j as e,p as Fe,E as ze,B as N,S as Me,l as Ue,m,x as U,L as te,D as re,q as oe,s as le,t as ie,v as ne}from"./index-DLqimMV8.js";import{P as T}from"./index-iG6a_0Cv.js";import{S as D,E as Te}from"./EditPostModal-FMrAoioO.js";import{T as De,a as $e,b as S,c as E}from"./tabs-CjUoFsGL.js";import{U as Be,A as C,a as k,b as L}from"./index-EfjSmcDM.js";import{u as Ie}from"./toast-7vBxPuBc.js";import{S as qe,u as Oe}from"./index-BgaOpAAA.js";import{S as $}from"./square-pen-CjVE55qt.js";import{A as Ve}from"./arrow-up-right-gebzYLSU.js";import{a as He}from"./dropdown-menu-7k7ytBg1.js";import{H as Re}from"./heart-D1UYKJAB.js";import{b as We}from"./bookmark-B2_N_nt6.js";import"./site-header-CKtPnSCF.js";import"./card-CY9-ve7w.js";import"./badge-CME7s750.js";import"./calendar-BcaNxl4E.js";import"./user-BOjY7V17.js";import"./log-out-Cu_b7vs0.js";import"./site-footer-btaBgloE.js";import"./input-FZRWGTRd.js";import"./loader-circle-ClwSyFO1.js";import"./crown-BrBsF1Iu.js";import"./map-pin-XNZDTA2K.js";import"./textarea-Dc95vB93.js";import"./send-COm1LQ5b.js";import"./trash-2-CP23ljvT.js";import"./label-DBxNtR5w.js";import"./select-d49l-vTK.js";import"./index-CFq4vo7_.js";import"./chevron-up-DKadsFnq.js";import"./circle-alert-Bp1UBQ88.js";const Ps=()=>{const{username:b}=ke(),w=Le(),{user:x,updateCover:ce}=Ae(),[t,v]=l.useState(null),[A,y]=l.useState([]),[B,F]=l.useState([]),[I,q]=l.useState([]),[_,de]=l.useState([]),[P,me]=l.useState([]),[ue,O]=l.useState(!0),[V,H]=l.useState(""),[he,xe]=l.useState("posts"),[pe,R]=l.useState(null),[ge,W]=l.useState(!1),[fe,X]=l.useState(!1),[je,Z]=l.useState(!1),[G,J]=l.useState(!1),[ve,K]=l.useState(!1),[Ne,Q]=l.useState(!1),[be,Y]=l.useState(!1),{addToast:p}=Ie(),c=!b||b===x?.username,z=l.useCallback(s=>!s||typeof s!="string"?null:/^https?:\/\//.test(s)?s:u.getPublicUrl(s.startsWith("/")?s.slice(1):s),[]),M=l.useCallback(s=>{if(!s)return s;const a={...s},r=s.avatar_url||s.foto_perfil||s.avatar;r&&(a.avatar_url=s.avatar_url||r,a.foto_perfil=z(r)||s.foto_perfil||null);const i=s.capa_url||s.cover_image||s.cover_url||s.capa;return i&&(a.capa_url=s.capa_url||(i.startsWith("/")?i:`/${i}`),a.cover_image=z(i)||s.cover_image||null),a},[z]);l.useEffect(()=>{const s=async()=>{if(c)try{const o=await m.getLikedPosts();F(o.posts||[])}catch(o){console.error("Erro ao carregar posts curtidos:",o)}},a=async()=>{if(c)try{const o=await m.getSavedPosts();q(o.posts||[])}catch(o){console.error("Erro ao carregar posts salvos:",o)}},r=async o=>{try{K(!0);const h=(await m.getUserFollowers(o)).followers||[];de(h),v(d=>d&&{...d,followers_count:h.length})}catch(j){console.error("Erro ao carregar seguidores:",j)}finally{K(!1)}},i=async o=>{try{Q(!0);const h=(await m.getUserFollowing(o)).following||[];me(h),v(d=>d&&{...d,following_count:h.length})}catch(j){console.error("Erro ao carregar seguindo:",j)}finally{Q(!1)}};(async()=>{O(!0),H("");try{let o;if(c&&x)o=(await m.getUser(x.id)).user;else{const d=await m.searchUsers(b),ae=Array.isArray(d.users)?d.users.find(Ce=>Ce.username===b):null;if(!ae)throw new Error("Usuário não encontrado");o=(await m.getUser(ae.id)).user}const j=M(o);v(j);const h=await m.getPosts({user_id:o.id});y(h.posts||h),c&&(s(),a()),o.id&&(r(o.id),i(o.id))}catch(o){H(o.message||"Erro ao carregar perfil")}finally{O(!1)}})()},[b,x,c,M]);const we=async(s,a)=>{try{const r=await m.updatePost(s,a);if(r.success)y(i=>i.map(n=>n.id===s?{...n,...r.post}:n)),p("Post atualizado com sucesso!","success");else throw new Error(r.message||"Erro ao atualizar post")}catch(r){throw console.error("Erro ao atualizar post:",r),p("Erro ao atualizar post. Tente novamente.","error"),r}},ye=async()=>{if(t)try{J(!0);const s=await m.toggleFollow(t.id);s.success&&v(a=>a&&{...a,isFollowed:s.following,followers_count:s.followers_count??s.followersCount??a.followers_count})}catch(s){console.error("Erro ao seguir:",s)}finally{J(!1)}},_e=async s=>{if(!(!s||!c)){if(!Oe.isImage(s)){p("Apenas imagens são permitidas para a capa.","error");return}if(s.size>u.UPLOAD.MAX_FILE_SIZE){const a=Math.round(u.UPLOAD.MAX_FILE_SIZE/1048576*10)/10;p(`Imagem deve ter no máximo ${a}MB.`,"error");return}try{Y(!0);const a=await ce(s);if(a.success&&a.user){const r=M(a.user);v(i=>({...i||{},...r})),p("Capa atualizada com sucesso!","success")}else p(a.message||"Erro ao atualizar capa.","error")}catch(a){console.error("Erro ao atualizar capa:",a),p("Erro ao atualizar capa. Tente novamente.","error")}finally{Y(!1)}}},g=l.useMemo(()=>{if(!t?.website)return null;const s=t.website.trim();if(!s)return null;const a=/^https?:\/\//i.test(s)?s:`https://${s}`;try{return new URL(a).href}catch(r){return console.warn("Website inválido para exibição:",s,r),null}},[t?.website]),ee=l.useMemo(()=>{if(!g)return null;try{const s=new URL(g),a=s.hostname.replace(/^www\./i,""),r=s.pathname&&s.pathname!=="/"?s.pathname:"";return`${a}${r}`}catch{return t?.website}},[g,t?.website]),Pe=l.useMemo(()=>t?.nome?t.nome.trim().split(" ")[0]||t.nome:"nossa empreendedora",[t?.nome]),f=l.useMemo(()=>{if(!c||!t)return[];const s=!!(t.foto_perfil||t.avatar_url),a=!!(t.cover_image||t.capa_url),r=!!(t.bio&&t.bio.trim().length>=30),i=!!g,n=!!(t.localizacao&&t.localizacao.trim().length>0);return[{id:"avatar",label:"Adicione uma foto de perfil acolhedora",completed:s},{id:"cover",label:"Personalize a capa do seu perfil",completed:a},{id:"bio",label:"Conte sua história em pelo menos 30 caracteres",completed:r},{id:"website",label:"Conecte a sua loja do marketplace",completed:i},{id:"localizacao",label:"Mostre de onde você empreende",completed:n}]},[c,g,t?.foto_perfil,t?.avatar_url,t?.cover_image,t?.capa_url,t?.bio,t?.localizacao]),se=l.useMemo(()=>{if(!f.length)return 100;const s=f.filter(a=>a.completed).length;return Math.round(s/f.length*100)},[f]),Se=l.useMemo(()=>c?f.some(s=>!s.completed):!1,[f,c]);if(ue)return e.jsx(T,{children:e.jsx(Fe,{size:"lg",text:"Carregando perfil..."})});if(V||!t)return e.jsx(T,{children:e.jsx(ze,{message:V||"Perfil não encontrado"})});const Ee=c?e.jsxs(N,{onClick:()=>w("/editar-perfil"),variant:"outline",className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Editar Perfil"]}):e.jsx(N,{onClick:ye,disabled:G,className:`min-w-[120px] ${t.isFollowed?"bg-white text-coral border-2 border-coral hover:bg-coral/5":"bg-coral text-white hover:bg-coral/90 border-2 border-coral"}`,children:G?"Atualizando...":t.isFollowed?"Seguindo":"Seguir"});return e.jsxs(T,{user:t,coverImage:t?.cover_image||t?.capa_url||t?.capa,canEditCover:c,onCoverSelect:_e,isCoverUploading:be,infoActions:Ee,children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[g&&e.jsxs("div",{className:"bg-gradient-to-r from-green-50 via-olive/5 to-white border border-olive/20 rounded-2xl p-6 shadow-sm flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-olive text-white shadow-md",children:e.jsx(Me,{className:"w-7 h-7"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-olive",children:"Loja oficial no marketplace"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mt-1",children:"Visite minha loja no marketplace!"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Descubra os produtos e serviços de ",Pe,"."]})]})]}),e.jsxs("div",{className:"flex flex-col items-start gap-2 sm:items-end",children:[e.jsx(N,{asChild:!0,variant:"secondary",className:"bg-olive text-white hover:bg-olive/90 shadow-md",children:e.jsxs("a",{href:g,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:["Visitar loja",e.jsx(Ve,{className:"w-4 h-4"})]})}),ee&&e.jsx("span",{className:"text-xs text-gray-500 break-all max-w-[220px] sm:text-right",children:ee})]})]}),Se&&e.jsxs("div",{className:"bg-white border border-coral/30 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-coral/10 flex items-center justify-center text-coral",children:e.jsx(qe,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Complete seu perfil"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Preencha algumas etapas para destacar ainda mais a sua marca."})]})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("div",{className:"h-2 rounded-full bg-gray-100 overflow-hidden",children:e.jsx("div",{className:"h-full bg-coral transition-all duration-500",style:{width:`${se}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[se,"% do perfil completo"]})]}),e.jsx("ul",{className:"mt-5 space-y-3",children:f.map(s=>e.jsxs("li",{className:"flex items-center gap-3",children:[s.completed?e.jsx(Ue,{className:"w-5 h-5 text-emerald-500"}):e.jsx(He,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:`text-sm ${s.completed?"text-emerald-600 line-through":"text-gray-700"}`,children:s.label})]},s.id))}),e.jsx("div",{className:"mt-6",children:e.jsxs(N,{onClick:()=>w("/editar-perfil"),variant:"outline",className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Atualizar perfil agora"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>X(!0),className:"p-4 bg-white rounded-lg shadow-sm border hover:bg-gray-50 transition-colors text-left",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Seguidores"}),e.jsx("div",{className:"text-lg font-semibold",children:t.followers_count||0})]}),e.jsxs("button",{onClick:()=>Z(!0),className:"p-4 bg-white rounded-lg shadow-sm border hover:bg-gray-50 transition-colors text-left",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Seguindo"}),e.jsx("div",{className:"text-lg font-semibold",children:t.following_count||0})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Publicações"}),e.jsx("div",{className:"text-lg font-semibold",children:A.length})]})]}),e.jsxs(De,{value:he,onValueChange:xe,className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-4",children:[e.jsxs(S,{value:"posts",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Posts"]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{value:"likes",className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Curtidas"]}),e.jsxs(S,{value:"saved",className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Salvos"]})]}),e.jsxs(S,{value:"connections",className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Conexões"]})]}),e.jsx(E,{value:"posts",className:"space-y-4 mt-6",children:A.length>0?A.map(s=>e.jsx(D,{post:s,currentUser:x,onLike:async(a,r,i)=>{try{y(n=>n.map(o=>o.id===a?{...o,user_liked:r,likes:i,isLiked:r}:o))}catch(n){console.error("Erro ao curtir:",n)}},onFollow:async(a,r,i)=>{t.id===a&&v(n=>({...n,followers_count:i,isFollowed:r}))},onDelete:c?async a=>{try{(await m.deletePost(a)).success&&y(i=>i.filter(n=>n.id!==a))}catch(r){console.error("Erro ao deletar:",r)}}:void 0,onUpdate:c?a=>{R(a),W(!0)}:void 0,showActions:!0},s.id)):e.jsx(U,{title:"Nenhum post ainda",description:c?"Você ainda não publicou nada.":"Este usuário não publicou nada."})}),c&&e.jsxs(e.Fragment,{children:[e.jsx(E,{value:"likes",className:"space-y-4 mt-6",children:B.length>0?B.map(s=>e.jsx(D,{post:s,currentUser:x,onLike:async(a,r,i)=>{try{F(n=>n.map(o=>o.id===a?{...o,user_liked:r,likes:i,isLiked:r}:o)),r||F(n=>n.filter(o=>o.id!==a))}catch(n){console.error("Erro ao curtir:",n)}},showActions:!0},s.id)):e.jsx(U,{title:"Nenhuma curtida ainda",description:"Posts que você curtir aparecerão aqui."})}),e.jsx(E,{value:"saved",className:"space-y-4 mt-6",children:I.length>0?I.map(s=>e.jsx(D,{post:s,currentUser:x,onSave:async(a,r)=>{r||q(i=>i.filter(n=>n.id!==a))},showActions:!0},s.id)):e.jsx(U,{title:"Nenhum post salvo",description:"Posts que você salvar aparecerão aqui."})})]}),e.jsx(E,{value:"connections",className:"space-y-4 mt-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-4",children:["Seguidores (",t.followers_count||0,")"]}),e.jsx("div",{className:"space-y-3",children:_.length>0?_.slice(0,5).map(s=>e.jsxs(te,{to:`/perfil/${s.username}`,className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs(C,{className:"w-10 h-10",children:[e.jsx(k,{src:s.avatar_url?u.getPublicUrl(s.avatar_url):s.foto_perfil?u.getPublicUrl(s.foto_perfil):""}),e.jsx(L,{className:"bg-coral text-white",children:s.nome?s.nome.charAt(0):"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium hover:underline truncate",children:s.nome}),e.jsxs("p",{className:"text-sm text-gray-500 hover:text-coral truncate",children:["@",s.username]})]})]},s.id)):e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum seguidor ainda."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-4",children:["Seguindo (",t.following_count||0,")"]}),e.jsx("div",{className:"space-y-3",children:P.length>0?P.slice(0,5).map(s=>e.jsxs(te,{to:`/perfil/${s.username}`,className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs(C,{className:"w-10 h-10",children:[e.jsx(k,{src:s.avatar_url?u.getPublicUrl(s.avatar_url):s.foto_perfil?u.getPublicUrl(s.foto_perfil):""}),e.jsx(L,{className:"bg-coral text-white",children:s.nome?s.nome.charAt(0):"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium hover:underline truncate",children:s.nome}),e.jsxs("p",{className:"text-sm text-gray-500 hover:text-coral truncate",children:["@",s.username]})]})]},s.id)):e.jsx("p",{className:"text-gray-500 text-sm",children:"Não está seguindo ninguém ainda."})})]})]})})]})]}),e.jsx(re,{open:fe,onOpenChange:X,children:e.jsxs(oe,{className:"max-w-md max-h-96 overflow-y-auto",children:[e.jsxs(le,{children:[e.jsxs(ie,{children:["Seguidores (",t.followers_count||0,")"]}),e.jsx(ne,{children:"Lista de pessoas que seguem este usuário."})]}),e.jsx("div",{className:"space-y-3",children:ve?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Carregando seguidores..."}):_.length>0?_.map(s=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg",children:[e.jsxs(C,{className:"h-10 w-10",children:[e.jsx(k,{src:s.avatar_url?u.getPublicUrl(s.avatar_url):""}),e.jsx(L,{children:s.nome?s.nome.charAt(0):"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.nome}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",s.username]})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>w(`/perfil/${s.username}`),children:"Ver perfil"})]},s.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Nenhum seguidor ainda."})})]})}),e.jsx(re,{open:je,onOpenChange:Z,children:e.jsxs(oe,{className:"max-w-md max-h-96 overflow-y-auto",children:[e.jsxs(le,{children:[e.jsxs(ie,{children:["Seguindo (",t.following_count||0,")"]}),e.jsx(ne,{children:"Lista de pessoas que este usuário segue."})]}),e.jsx("div",{className:"space-y-3",children:Ne?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Carregando seguindo..."}):P.length>0?P.map(s=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg",children:[e.jsxs(C,{className:"h-10 w-10",children:[e.jsx(k,{src:s.avatar_url?u.getPublicUrl(s.avatar_url):""}),e.jsx(L,{children:s.nome?s.nome.charAt(0):"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.nome}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",s.username]})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>w(`/perfil/${s.username}`),children:"Ver perfil"})]},s.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Não está seguindo ninguém ainda."})})]})}),e.jsx(Te,{isOpen:ge,onClose:()=>{W(!1),R(null)},post:pe,onSave:we})]})};export{Ps as default};
//# sourceMappingURL=ProfilePage-DWDD_ljn.js.map
