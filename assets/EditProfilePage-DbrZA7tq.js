import{c as M,r as b,y as I,j as e,D as O,q as _,s as V,t as q,v as H,B as h,m as G,a as J,u as $,R as S,p as U,T as K}from"./index-DLqimMV8.js";import{u as W,v as L}from"./useForm-C_j8H-C3.js";import{a as Z,C as Q}from"./index-iG6a_0Cv.js";import{I as p}from"./input-FZRWGTRd.js";import{T as X}from"./textarea-Dc95vB93.js";import{L as c}from"./label-DBxNtR5w.js";import{C,b as A,c as F,a as P}from"./card-CY9-ve7w.js";import{A as Y,a as ee,b as se}from"./index-EfjSmcDM.js";import{u as ae}from"./toast-7vBxPuBc.js";import{u as te}from"./index-BgaOpAAA.js";import{S as re}from"./square-pen-CjVE55qt.js";import{A as ie}from"./arrow-left-BeWKRKPu.js";import"./site-header-CKtPnSCF.js";import"./badge-CME7s750.js";import"./dropdown-menu-7k7ytBg1.js";import"./bookmark-B2_N_nt6.js";import"./heart-D1UYKJAB.js";import"./calendar-BcaNxl4E.js";import"./user-BOjY7V17.js";import"./log-out-Cu_b7vs0.js";import"./site-footer-btaBgloE.js";import"./loader-circle-ClwSyFO1.js";import"./crown-BrBsF1Iu.js";import"./map-pin-XNZDTA2K.js";import"./circle-alert-Bp1UBQ88.js";/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],oe=M("save",le),ne=({isOpen:m,onClose:s,currentUsername:n,onSave:z})=>{const[l,f]=b.useState(n||""),[o,j]=b.useState(!1),{addToast:d}=ae();I.useEffect(()=>{m&&f(n||"")},[m,n]);const y=t=>t.trim()?t.length<3||t.length>30?"Username deve ter entre 3 e 30 caracteres":/^[a-zA-Z0-9_.]+$/.test(t)?null:"Username deve conter apenas letras, números, _ ou .":"Username é obrigatório",x=async()=>{const t=y(l);if(t){d(t,"error");return}if(l===n){d("Nenhuma alteração foi feita","info"),s();return}j(!0);try{const g=await(await fetch(`${G.baseURL}/auth/username`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${JSON.parse(localStorage.getItem("empowerup_user")||"{}").token}`},body:JSON.stringify({username:l.trim()})})).json();g.success?(d("Username atualizado com sucesso!","success"),z(g.user),s()):d(g.message||"Erro ao atualizar username","error")}catch(w){console.error("Erro ao atualizar username:",w),d("Erro ao conectar com o servidor","error")}finally{j(!1)}},N=t=>{t.key==="Enter"&&(t.preventDefault(),x())};return e.jsx(O,{open:m,onOpenChange:s,children:e.jsxs(_,{className:"max-w-md mx-auto",children:[e.jsxs(V,{children:[e.jsx(q,{children:"Editar Username"}),e.jsx(H,{children:"Altere seu nome de usuário único para personalizar seu perfil."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"username",children:"Novo Username"}),e.jsx(p,{id:"username",value:l,onChange:t=>f(t.target.value),onKeyPress:N,placeholder:"meunovousername",maxLength:30,disabled:o}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Apenas letras, números, _ ou . (3-30 caracteres)"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:s,disabled:o,className:"flex-1",children:"Cancelar"}),e.jsx(h,{type:"button",onClick:x,disabled:o||!l.trim()||l===n,className:"flex-1",children:o?"Salvando...":"Salvar"})]})]})]})})},Ie=()=>{const m=J(),{user:s,updateProfile:n,updateAvatar:z}=$(),[l,f]=b.useState(!1),[o,j]=b.useState({show:!1,message:"",type:"info"}),[d,y]=b.useState(!1),x=a=>{const r=a.replace(/\D/g,"").slice(0,11);let i="";return r.length>0&&(i+="("+r.slice(0,2)),r.length>=3?i+=") "+r.slice(2,7):r.length>2&&(i+=") "+r.slice(2)),r.length>=8&&(i+="-"+r.slice(7,11)),i},{values:N,errors:t,handleBlur:w,handleSubmit:g,getFieldProps:v,setFormValues:T,setValue:k,isSubmitting:E}=W({nome:s?.nome||"",email:s?.email||"",telefone:s?.telefone?x(s.telefone):"",bio:s?.bio||"",website:s?.website||"",localizacao:s?.localizacao||""},{nome:L.name,email:L.email,telefone:a=>{if(!a)return null;const r=a.replace(/\D/g,"");return r.length<10||r.length>11?"Telefone deve ter 10 ou 11 dígitos":null},bio:a=>a&&a.length>500?"Bio deve ter no máximo 500 caracteres":null,website:a=>{if(!a)return null;try{return new URL(a),null}catch{return"URL inválida"}}});I.useEffect(()=>{s&&(console.log("Dados do usuário no EditProfile:",s),T({nome:s.nome||"",email:s.email||"",telefone:s.telefone?x(s.telefone):"",bio:s.bio||"",website:s.website||"",localizacao:s.localizacao||""}))},[s,T]);const R=async a=>{const r={...a,telefone:a.telefone?a.telefone.replace(/\D/g,""):""},i=await n(r);return i.success?(u("Perfil atualizado com sucesso!","success"),setTimeout(()=>m(S.PROFILE),1500)):u(i.message||"Erro ao atualizar perfil","error"),i},D=async a=>{const r=a.target.files?.[0];if(r){if(!te.isImage(r)){u("Apenas imagens são permitidas","error");return}if(r.size>5*1024*1024){u("Imagem deve ter no máximo 5MB","error");return}try{f(!0);const i=await z(r);i.success?u("Avatar atualizado com sucesso!","success"):u(i.message||"Erro ao atualizar avatar","error")}catch{u("Erro ao fazer upload do avatar","error")}finally{f(!1)}}},B=a=>{n(a)},u=(a,r)=>{j({show:!0,message:a,type:r})};return e.jsxs(Z,{title:"Editar Perfil",subtitle:"Atualize suas informações pessoais",breadcrumbs:[{label:"Perfil",href:S.PROFILE},{label:"Editar"}],actions:[e.jsxs(h,{variant:"outline",onClick:()=>m(S.PROFILE),className:"flex items-center",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Voltar"]},"back")],children:[e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx("form",{onSubmit:a=>{a.preventDefault(),g(R)},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(A,{children:e.jsx(F,{children:"Foto de Perfil"})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Y,{className:"w-24 h-24",children:[e.jsx(ee,{src:s?.foto_perfil,alt:s?.nome}),e.jsx(se,{children:s?.nome?.charAt(0).toUpperCase()})]}),l&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:e.jsx(U,{size:"sm",showText:!1})})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:D,className:"hidden",disabled:l}),e.jsx("label",{htmlFor:"avatar-upload",children:e.jsx(h,{type:"button",variant:"outline",size:"sm",disabled:l,className:"cursor-pointer",asChild:!0,children:e.jsxs("span",{children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),l?"Enviando...":"Alterar Foto"]})})}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"JPG, PNG ou GIF. Máximo 5MB."})]})]})})]}),e.jsxs(C,{children:[e.jsx(A,{children:e.jsx(F,{children:"Informações Básicas"})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"nome",children:"Nome Completo *"}),e.jsx(p,{id:"nome",...v("nome"),placeholder:"Seu nome completo"}),t.nome&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.nome})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{htmlFor:"username",children:"Username"}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:()=>y(!0),className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Editar"]})]}),e.jsx("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 border rounded-md",children:e.jsxs("span",{className:"text-gray-600",children:["@",s?.username]})}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Seu username único para ser encontrado na plataforma"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"email",children:"Email *"}),e.jsx(p,{id:"email",type:"email",...v("email"),placeholder:"seu@email.com"}),t.email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.email})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"telefone",children:"Telefone"}),e.jsx(p,{id:"telefone",name:"telefone",value:N.telefone||"",onChange:a=>{const r=x(a.target.value);k("telefone",r)},onBlur:w,placeholder:"(11) 99999-9999"}),t.telefone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.telefone})]})]})]}),e.jsxs(C,{children:[e.jsx(A,{children:e.jsx(F,{children:"Informações Adicionais"})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"bio",children:"Biografia"}),e.jsx(X,{id:"bio",...v("bio"),placeholder:"Conte um pouco sobre você...",rows:4}),e.jsxs("div",{className:"flex justify-between mt-1",children:[t.bio&&e.jsx("p",{className:"text-sm text-red-600",children:t.bio}),e.jsxs("p",{className:"text-sm text-gray-500 ml-auto",children:[N.bio?.length||0,"/500"]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"website",children:"Website"}),e.jsx(p,{id:"website",...v("website"),placeholder:"https://seusite.com",required:!1}),t.website&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.website})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"localizacao",children:"Localização"}),e.jsx(p,{id:"localizacao",...v("localizacao"),placeholder:"Cidade, Estado",required:!1})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>m(S.PROFILE),disabled:E,children:"Cancelar"}),e.jsxs(h,{type:"submit",disabled:E,className:"flex items-center",children:[E?e.jsx(U,{size:"sm",showText:!1,className:"mr-2"}):e.jsx(oe,{className:"w-4 h-4 mr-2"}),E?"Salvando...":"Salvar Alterações"]})]})]})})}),e.jsx(K,{message:o.message,type:o.type,isVisible:o.show,onClose:()=>j({...o,show:!1})}),e.jsx(ne,{isOpen:d,onClose:()=>y(!1),currentUsername:s?.username,onSave:B})]})};export{Ie as default};
//# sourceMappingURL=EditProfilePage-DbrZA7tq.js.map
