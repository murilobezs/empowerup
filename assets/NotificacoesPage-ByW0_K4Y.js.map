{"version":3,"file":"NotificacoesPage-ByW0_K4Y.js","sources":["../../src/pages/NotificacoesPage.jsx"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { SiteHeader } from '../components/site-header';\r\nimport CommunityLeftSidebar from '../components/layout/CommunityLeftSidebar';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '../components/ui/card';\r\nimport { Button } from '../components/ui/button';\r\nimport { Avatar, AvatarFallback, AvatarImage } from '../components/ui/avatar';\r\nimport { Badge } from '../components/ui/badge';\r\nimport { useNotifications } from '../contexts/NotificationsContext';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport config from '../config/config';\r\nimport { formatTimeAgo } from '../utils';\r\nimport {\r\n  Bell,\r\n  Heart,\r\n  MessageCircle,\r\n  UserPlus,\r\n  Bookmark,\r\n  Users,\r\n  Sparkles,\r\n  BookOpen,\r\n  Megaphone,\r\n  Check,\r\n  RefreshCw,\r\n} from 'lucide-react';\r\nimport {\r\n  normalizeNotificationType,\r\n  getNotificationActorName,\r\n  getNotificationMessage,\r\n  getNotificationSubtitle,\r\n  getNotificationTargetUrl,\r\n} from '../utils/notificationUtils';\r\n\r\nconst ICON_RENDERERS = {\r\n  like: (className = 'h-5 w-5 text-red-500') => <Heart className={className} />,\r\n  comment: (className = 'h-5 w-5 text-blue-500') => <MessageCircle className={className} />,\r\n  follow: (className = 'h-5 w-5 text-green-500') => <UserPlus className={className} />,\r\n  save: (className = 'h-5 w-5 text-purple-500') => <Bookmark className={className} />,\r\n  message: (className = 'h-5 w-5 text-blue-500') => <MessageCircle className={className} />,\r\n  group: (className = 'h-5 w-5 text-emerald-500') => <Users className={className} />,\r\n  course: (className = 'h-5 w-5 text-amber-500') => <BookOpen className={className} />,\r\n  system: (className = 'h-5 w-5 text-coral') => <Sparkles className={className} />,\r\n  campaign: (className = 'h-5 w-5 text-orange-500') => <Megaphone className={className} />,\r\n  default: (className = 'h-5 w-5 text-gray-500') => <Bell className={className} />,\r\n};\r\n\r\nconst getNotificationIcon = (notification) => {\r\n  const key = normalizeNotificationType(notification);\r\n  const renderer = ICON_RENDERERS[key] || ICON_RENDERERS.default;\r\n  return renderer();\r\n};\r\n\r\nexport default function NotificacoesPage() {\r\n  const { user } = useAuth();\r\n  const {\r\n    notifications,\r\n    unreadCount,\r\n    loading,\r\n    error,\r\n    lastUpdatedAt,\r\n    refresh,\r\n    markAsRead,\r\n    markAllAsRead,\r\n  } = useNotifications();\r\n\r\n  useEffect(() => {\r\n    // Carregar notificações quando a página for aberta\r\n    refresh();\r\n  }, [refresh]);\r\n\r\n  const handleNotificationClick = async (notification) => {\r\n    if (!notification.is_read) {\r\n      await markAsRead(notification.id);\r\n    }\r\n\r\n    const targetUrl = getNotificationTargetUrl(notification);\r\n    if (targetUrl) {\r\n      window.location.href = targetUrl;\r\n    }\r\n  };\r\n\r\n  const handleMarkAllAsRead = async () => {\r\n    if (unreadCount === 0) return;\r\n    await markAllAsRead();\r\n  };\r\n\r\n  const handleRefresh = async () => {\r\n    await refresh();\r\n  };\r\n\r\n  if (!user) {\r\n    return (\r\n      <>\r\n        <SiteHeader />\r\n        <main className=\"container mx-auto px-4 py-6 max-w-7xl\">\r\n          <div className=\"text-center py-12\">\r\n            <p className=\"text-gray-500\">Você precisa estar logado para ver suas notificações.</p>\r\n          </div>\r\n        </main>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <SiteHeader />\r\n      <main className=\"container mx-auto px-4 py-6 max-w-7xl\">\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6\">\r\n          {/* Sidebar esquerda */}\r\n          <CommunityLeftSidebar active=\"notificacoes\" className=\"lg:col-span-3\" />\r\n\r\n          {/* Conteúdo principal */}\r\n          <div className=\"lg:col-span-9\">\r\n            <Card>\r\n              <CardHeader>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <CardTitle className=\"text-2xl font-bold\">Notificações</CardTitle>\r\n                    {lastUpdatedAt && (\r\n                      <p className=\"text-sm text-gray-500 mt-1\">\r\n                        Última atualização: {formatTimeAgo(lastUpdatedAt)}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={handleRefresh}\r\n                      disabled={loading}\r\n                    >\r\n                      <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n                      Atualizar\r\n                    </Button>\r\n                    {unreadCount > 0 && (\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        onClick={handleMarkAllAsRead}\r\n                      >\r\n                        <Check className=\"h-4 w-4 mr-2\" />\r\n                        Marcar todas como lidas\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {unreadCount > 0 && (\r\n                  <div className=\"flex items-center gap-2 mt-4\">\r\n                    <Badge variant=\"destructive\">\r\n                      {unreadCount} não {unreadCount === 1 ? 'lida' : 'lidas'}\r\n                    </Badge>\r\n                  </div>\r\n                )}\r\n              </CardHeader>\r\n              <CardContent className=\"p-0\">\r\n                {error && (\r\n                  <div className=\"px-6 py-4 text-sm text-red-600 bg-red-50 border-b border-red-100\">\r\n                    {error}\r\n                  </div>\r\n                )}\r\n                \r\n                {loading ? (\r\n                  <div className=\"flex items-center justify-center py-12\">\r\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-coral\"></div>\r\n                    <span className=\"ml-3 text-gray-600\">Carregando notificações...</span>\r\n                  </div>\r\n                ) : notifications.length > 0 ? (\r\n                  <div className=\"divide-y divide-gray-100\">\r\n                    {notifications.map((notification) => {\r\n                      const actorName = getNotificationActorName(notification);\r\n                      const subtitle = getNotificationSubtitle(notification);\r\n                      const actorUsername = notification.from_user?.username;\r\n\r\n                      return (\r\n                        <button\r\n                          type=\"button\"\r\n                          key={notification.id}\r\n                          className={`w-full text-left p-6 transition-colors hover:bg-gray-50 ${\r\n                            !notification.is_read ? 'bg-blue-50' : 'bg-white'\r\n                          }`}\r\n                          onClick={() => handleNotificationClick(notification)}\r\n                        >\r\n                          <div className=\"flex items-start space-x-4\">\r\n                            {actorUsername ? (\r\n                              <Link \r\n                                to={`/perfil/${actorUsername}`}\r\n                                onClick={(e) => e.stopPropagation()}\r\n                                className=\"flex-shrink-0\"\r\n                              >\r\n                                <Avatar className=\"w-12 h-12 hover:opacity-80 transition-opacity\">\r\n                                  <AvatarImage\r\n                                    src={notification.from_user?.avatar_url ?\r\n                                      config.getPublicUrl(notification.from_user.avatar_url) : ''\r\n                                    }\r\n                                  />\r\n                                  <AvatarFallback className=\"bg-coral text-white\">\r\n                                    {actorName ? actorName.charAt(0).toUpperCase() : 'N'}\r\n                                  </AvatarFallback>\r\n                                </Avatar>\r\n                              </Link>\r\n                            ) : (\r\n                              <Avatar className=\"w-12 h-12\">\r\n                                <AvatarImage\r\n                                  src={notification.from_user?.avatar_url ?\r\n                                    config.getPublicUrl(notification.from_user.avatar_url) : ''\r\n                                  }\r\n                                />\r\n                                <AvatarFallback className=\"bg-coral text-white\">\r\n                                  {actorName ? actorName.charAt(0).toUpperCase() : 'N'}\r\n                                </AvatarFallback>\r\n                              </Avatar>\r\n                            )}\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <div className=\"flex items-start justify-between\">\r\n                                <div className=\"flex items-center space-x-2\">\r\n                                  {getNotificationIcon(notification)}\r\n                                  {!notification.is_read && (\r\n                                    <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\r\n                                  )}\r\n                                </div>\r\n                                <span className=\"text-sm text-gray-500\">\r\n                                  {formatTimeAgo(notification.created_at)}\r\n                                </span>\r\n                              </div>\r\n                              <p className=\"text-base mt-2 text-gray-900\">\r\n                                {actorName && actorUsername ? (\r\n                                  <>\r\n                                    <Link \r\n                                      to={`/perfil/${actorUsername}`}\r\n                                      onClick={(e) => e.stopPropagation()}\r\n                                      className=\"font-medium hover:underline\"\r\n                                    >\r\n                                      {actorName}\r\n                                    </Link>{' '}\r\n                                    {getNotificationMessage(notification)}\r\n                                  </>\r\n                                ) : actorName ? (\r\n                                  <>\r\n                                    <span className=\"font-medium\">{actorName}</span>{' '}\r\n                                    {getNotificationMessage(notification)}\r\n                                  </>\r\n                                ) : (\r\n                                  getNotificationMessage(notification)\r\n                                )}\r\n                              </p>\r\n                              {subtitle && (\r\n                                <p className=\"text-sm text-gray-500 mt-1\">{subtitle}</p>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"py-12 text-center\">\r\n                    <Bell className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\r\n                    <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n                      Nenhuma notificação\r\n                    </h3>\r\n                    <p className=\"text-gray-500\">\r\n                      Suas notificações aparecerão aqui quando você receber curtidas, comentários e outras interações.\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </>\r\n  );\r\n}"],"names":["ICON_RENDERERS","className","jsx","Heart","MessageCircle","UserPlus","Bookmark","Users","BookOpen","Sparkles","Megaphone","Bell","getNotificationIcon","notification","key","normalizeNotificationType","NotificacoesPage","user","useAuth","notifications","unreadCount","loading","error","lastUpdatedAt","refresh","markAsRead","markAllAsRead","useNotifications","useEffect","handleNotificationClick","targetUrl","getNotificationTargetUrl","handleMarkAllAsRead","handleRefresh","jsxs","Fragment","SiteHeader","CommunityLeftSidebar","Card","CardHeader","CardTitle","formatTimeAgo","Button","RefreshCw","Check","Badge","CardContent","actorName","getNotificationActorName","subtitle","getNotificationSubtitle","actorUsername","Link","e","Avatar","AvatarImage","config","AvatarFallback","getNotificationMessage"],"mappings":"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"}